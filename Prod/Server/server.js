!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var u=r[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=0)}({"/Y4+":function(e,t){e.exports=require("babel-runtime/core-js/promise")},0:function(e,t,r){e.exports=r("NHnr")},"18Rh":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r("/Y4+"),a=n(u),i=r("G4N/"),s=n(i),o=r("ZrOi"),c=n(o),f=r("W7zC"),l=n(f),p=r("UT68"),d=n(p),h=r("6kPO"),g=n(h),v=r("DTxd"),x=n(v),w=function(){function e(){(0,l.default)(this,e)}return(0,d.default)(e,[{key:"init",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.config=t,this.cacheManager=g.default.caching({store:x.default,options:{ttl:60*this._getCacheConfigProperty("ttl")||1,maxsize:1e3*this._getCacheConfigProperty("maxsize")||1e6,path:this._getCacheConfigProperty("path")||"cache",preventfill:!0}});case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"_getCacheConfigProperty",value:function(e){return this.config&&this.config.cache&&this.config.cache[e]?this.config.cache[e]:null}},{key:"get",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(s.default.mark(function e(t){var r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,e.abrupt("return",new a.default(function(e){r.cacheManager.get(t,function(t,r){return e(t?null:r)})}));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"set",value:function(e,t){this.cacheManager.set(e,t)}},{key:"del",value:function(e){this.cacheManager.del(e)}}]),e}();t.default=new w},"2vqB":function(e,t){e.exports=require("puppeteer")},"5Mx4":function(e,t){e.exports=require("url-regex")},"6kPO":function(e,t){e.exports=require("cache-manager")},DTxd:function(e,t){e.exports=require("cache-manager-fs")},"G4N/":function(e,t){e.exports=require("babel-runtime/regenerator")},KtRv:function(e,t){e.exports=require("url-parse")},MocO:function(e,t){e.exports=require("body-parser")},NHnr:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r("G4N/"),a=n(u),i=r("ZrOi"),s=n(i),o=r("W7zC"),c=n(o),f=r("UT68"),l=n(f),p=r("ry2S"),d=n(p),h=r("vHs2"),g=(r("ROiT"),r("Zz1P")),v=n(g),x=r("cce7"),w=n(x),y=function(){function e(){(0,c.default)(this,e),global.chalk=d.default,global.log=this.log,global.now=this.now,this.initServer()}return(0,l.default)(e,[{key:"log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cyan";console.log(d.default[t+"Bright"](e)+d.default.whiteBright("\t at "+now()))}},{key:"now",value:function(){return(0,v.default)(new Date).format("YYYY-MM-DD HH:mm:ss")}},{key:"initServer",value:function(){function e(){return t.apply(this,arguments)}var t=(0,s.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:log("Server start"),e.prev=1,this.config=JSON.parse((0,h.readFileSync)("static/config.json","utf8")),global.config=this.config,e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),log(e.t0,"red"),log("Server fail cuz config.json incorrect or not exist","red"),e.abrupt("return");case 11:new w.default(this.config);case 12:case"end":return e.stop()}},e,this,[[1,6]])}));return e}()}]),e}();t.default=new y},ROiT:function(e,t){e.exports=require("yargs")},TKZa:function(e,t){e.exports=require("express")},UT68:function(e,t){e.exports=require("babel-runtime/helpers/createClass")},UU9W:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r("/Y4+"),a=n(u),i=r("G4N/"),s=n(i),o=r("ZrOi"),c=n(o),f=r("W7zC"),l=n(f),p=r("UT68"),d=n(p),h=r("2vqB"),g=n(h),v=function(){function e(){(0,l.default)(this,e)}return(0,d.default)(e,[{key:"init",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.debug=1==t.debug,this.timeout=t.timeout||5e3,e.next=4,g.default.launch({headless:!this.debug});case 4:this.browser=e.sent;case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"render",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(s.default.mark(function e(t){var r=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new a.default(function(e){return r._handleRender(e,t)}));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"_handleRender",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,c.default)(s.default.mark(function e(t,r){var n,u=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.browser.newPage();case 2:return this.page=e.sent,this.wait=setTimeout((0,c.default)(s.default.mark(function e(){var r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u._getResult("Timeout");case 2:return r=e.sent,t(r),e.abrupt("return");case 5:case"end":return e.stop()}},e,u)})),this.timeout),e.next=6,this._setupPage(r);case 6:n=e.sent,t(n);case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"_setupPage",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(s.default.mark(function e(t){var r,n=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,e.abrupt("return",new a.default(function(){var e=(0,c.default)(s.default.mark(function e(u){var a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.page.exposeFunction("ServerSideRenderStart",function(){var e=(0,c.default)(s.default.mark(function e(t,a){var i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._getResult(t,a);case 2:i=e.sent,u(i);case 4:case"end":return e.stop()}},e,n)}));return function(t,r){return e.apply(this,arguments)}}()),a=void 0,e.prev=2,e.next=5,r.page.goto(t,{timeout:15e3});case 5:a=e.sent,e.next=17;break;case 8:return e.prev=8,e.t0=e.catch(2),log("page not found","red"),e.t1=u,e.next=14,r._getResult("PageError",404);case 14:return e.t2=e.sent,(0,e.t1)(e.t2),e.abrupt("return");case 17:if(a&&a.ok()){e.next=25;break}return log("page not found","red"),e.t3=u,e.next=22,r._getResult("PageError",404);case 22:return e.t4=e.sent,(0,e.t3)(e.t4),e.abrupt("return");case 25:case"end":return e.stop()}},e,n,[[2,8]])}));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"_getResult",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(s.default.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.wait&&clearTimeout(this.wait),e.next=3,this.page.content();case 3:return r=e.sent,this.page.close(),e.abrupt("return",{statusCode:n,type:t,content:r});case 6:case"end":return e.stop()}},e,this)}));return e}()}]),e}();t.default=new v},VPVQ:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r("g7xc"),a=n(u),i=r("G4N/"),s=n(i),o=r("ZrOi"),c=n(o),f=r("W7zC"),l=n(f),p=r("UT68"),d=n(p),h=r("TKZa"),g=n(h),v=r("MocO"),x=n(v),w=r("KtRv"),y=n(w),b=r("5Mx4"),k=n(b),_=r("UU9W"),m=n(_),O=r("18Rh"),P=n(O),R=function(){function e(){(0,l.default)(this,e)}return(0,d.default)(e,[{key:"init",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.config=t,this.crawler=m.default,this.cache=P.default,e.next=5,this.cache.init(this.config);case 5:return e.next=7,this.crawler.init(this.config);case 7:return this.app=(0,g.default)(),this.app.use(x.default.json()),this.app.use(x.default.urlencoded({extended:!0})),this.app.use(function(e,t,r,n){r.sendStatus(e.statusCode)}),this._setupRoute(),e.abrupt("return",this.app);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"_setupRoute",value:function(){var e=this;return this.app.get("/render",function(t,r){return e._handleRender(t,r)}),this.app.all("*",function(e,t){return t.sendStatus(400)}),this.app}},{key:"_handleRender",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,c.default)(s.default.mark(function e(t,r){var n,u,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.query.url,(0,k.default)().test(n)){e.next=4;break}return r.status(400).send("Bad url"),e.abrupt("return");case 4:if(this._isAllowOrigin(n)){e.next=7;break}return r.status(403).send("Origin not allow"),e.abrupt("return");case 7:return e.next=9,this.cache.get(n);case 9:if(u=e.sent,a=void 0,!u){e.next=16;break}log("Get cache result: "+n),a=u,e.next=21;break;case 16:return log("Start render: "+n),e.next=19,this.crawler.render(n);case 19:a=e.sent,this.cache.set(n,a);case 21:this._logResult(n,a),r.status(200).json(a);case 23:case"end":return e.stop()}},e,this)}));return e}()},{key:"_isValidUrl",value:function(e){return"string"==typeof e&&new RegExp(/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:\/?#[\]@!\$&'\(\)\*\+,;=.]+$/g).test(e)}},{key:"_isAllowOrigin",value:function(e){var t=new y.default(e).origin;return"*"==this.config.allowOrigin||("string"==typeof this.config.allowOrigin?this.config.allowOrigin==t:!!Array.isArray(this.config.allowOrigin)&&this.config.allowOrigin.indexOf(t)>-1)}},{key:"_logResult",value:function(e,t){var r="PageError"==t.type?"red":"green";log(""+e,r),log("Response: "+t.statusCode+", "+t.type,r),this.config.debug&&log((0,a.default)(t),"magenta")}}]),e}();t.default=new R},W7zC:function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},ZrOi:function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},Zz1P:function(e,t){e.exports=require("moment")},cce7:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r("G4N/"),a=n(u),i=r("ZrOi"),s=n(i),o=r("W7zC"),c=n(o),f=r("UT68"),l=n(f),p=r("gHkb"),d=n(p),h=r("VPVQ"),g=n(h),v=function(){function e(t){(0,c.default)(this,e),this.config=t,this.port=this.config.port||3e3,this.host=this.config.host||"localhost",log("WebServer listen at http://"+this.host+":"+this.port),this.setupApp()}return(0,l.default)(e,[{key:"setupApp",value:function(){function e(){return t.apply(this,arguments)}var t=(0,s.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.default.init(this.config);case 2:this.app=e.sent,d.default.createServer(this.app).listen(this.port,this.host);case 4:case"end":return e.stop()}},e,this)}));return e}()}]),e}();t.default=function(e){return new v(e)}},g7xc:function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},gHkb:function(e,t){e.exports=require("http")},ry2S:function(e,t){e.exports=require("chalk")},vHs2:function(e,t){e.exports=require("fs")}})});